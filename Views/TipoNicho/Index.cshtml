@using CemSys.Models.ViewModel
@model ABMRepositoryVM<TipoNicho>

@{
    string action = (Model.EsModificacion == true) ? "Modificar" : "Registrar";
    string actionTexto = (Model.EsModificacion == true) ? "Modificar" : "Registrar";
}

<div class="main-content">
    <h1>Tipo Nicho</h1>

    <form asp-action="@action" method="post">
        <label class="form-label" for="tipo">Tipo nicho</label>
        <input type="hidden" name="id" value="@Model.Modelo?.IdTipoNicho" />
        <input class="form-control-sm" type="text" name="tipo" value="@Model.Modelo?.TipoNicho1" required maxlength="15" id="tipo" />
        <input class="btn btn-primary" type="submit" name="name" value="@actionTexto" />
    </form>

    @if (Model.Lista.Count == 0)
    {
        <p>No hay datos para mostrar</p>
    }
    else
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Predeterminado</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var tipo in Model.Lista)
                {
                    <tr>
                        <td>@tipo.TipoNicho1</td>
                        <td>
                            <!-- Radio buttons agrupados -->
                            <input type="radio"
                                   name="idTipoPredeterminado"
                                   value="@tipo.IdTipoNicho"
                            @(tipo.PorDefecto ? "checked" : "") />
                        </td>
                        <td>
                            <form asp-action="Modificar" method="get" style="display: inline-block;">
                                <input type="hidden" name="id" value="@tipo.IdTipoNicho" />
                                <input type="submit" class="btn btn-dark" value="Modificar" />
                            </form>
                            <form asp-action="Eliminar" method="post" style="display: inline-block;">
                                <input type="hidden" name="id" value="@tipo.IdTipoNicho" />
                                <input type="submit" class="btn btn-danger" value="Eliminar" />
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Formulario para guardar el predeterminado -->
        <form asp-action="EstablecerPredeterminado" method="post">
            <!-- Campo para capturar el valor del radio seleccionado -->
            <input type="hidden" id="selectedId" name="idTipoPredeterminado" />
            <input type="submit" class="btn btn-primary" value="Guardar Predeterminado"
                   onclick="document.getElementById('selectedId').value = document.querySelector('input[name=idTipoPredeterminado]:checked').value;" />
        </form>
        <p>@ViewData["MensajeEmitir"]</p>
    }
</div>
